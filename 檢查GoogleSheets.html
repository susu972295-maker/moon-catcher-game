<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æª¢æŸ¥ Google Sheets æ•¸æ“š</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .check-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background: #45a049;
        }
        .result {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #4CAF50;
        }
        .error {
            border-left-color: #f44336;
            background: #ffebee;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>ğŸ” æª¢æŸ¥ Google Sheets æ•¸æ“š</h1>
    
    <div class="check-section">
        <h2>ğŸ“Š æª¢æŸ¥æ‰€æœ‰æ•¸æ“š</h2>
        <button onclick="checkAllData()">æª¢æŸ¥æ‰€æœ‰æ•¸æ“š</button>
        <div id="allDataResult" class="result" style="display: none;"></div>
    </div>
    
    <div class="check-section">
        <h2>ğŸ”§ æ¸¬è©¦ doGet å‡½æ•¸</h2>
        <button onclick="testDoGet()">æ¸¬è©¦ doGet å‡½æ•¸</button>
        <div id="doGetResult" class="result" style="display: none;"></div>
    </div>
    
    <div class="check-section">
        <h2>ğŸ“‹ æ•¸æ“šåˆ†æ</h2>
        <button onclick="analyzeData()">åˆ†ææ•¸æ“š</button>
        <div id="analyzeResult" class="result" style="display: none;"></div>
    </div>

    <script>
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyT2k3Y7Q04Bc7_WCtbOM6-cY3G7mbEL6T28DjAaoWU7aquiMaWNoPybleM47khMW8r/exec';
        
        async function checkAllData() {
            const resultDiv = document.getElementById('allDataResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<p>ğŸ”„ æ­£åœ¨æª¢æŸ¥æ‰€æœ‰æ•¸æ“š...</p>';
            
            try {
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('åŸå§‹æ•¸æ“š:', data);
                
                resultDiv.innerHTML = `
                    <h3>âœ… æ•¸æ“šæª¢æŸ¥çµæœ</h3>
                    <p><strong>æˆåŠŸç‹€æ…‹ï¼š</strong> ${data.success ? 'æ˜¯' : 'å¦'}</p>
                    <p><strong>æ•¸æ“šç­†æ•¸ï¼š</strong> ${data.data ? data.data.length : 0}</p>
                    <p><strong>éŒ¯èª¤ä¿¡æ¯ï¼š</strong> ${data.error || 'ç„¡'}</p>
                `;
                
                if (data.data && data.data.length > 0) {
                    resultDiv.innerHTML += `
                        <h4>ğŸ“‹ è©³ç´°æ•¸æ“šï¼š</h4>
                        <table>
                            <tr>
                                <th>æ’å</th>
                                <th>æ™‚é–“</th>
                                <th>åå­—</th>
                                <th>åˆ†æ•¸</th>
                            </tr>
                            ${data.data.map((player, index) => `
                                <tr>
                                    <td>${index + 1}</td>
                                    <td>${player.time}</td>
                                    <td>${player.name}</td>
                                    <td>${player.score}</td>
                                </tr>
                            `).join('')}
                        </table>
                    `;
                } else {
                    resultDiv.innerHTML += '<p style="color: red;">âŒ æ²’æœ‰æ•¸æ“šæˆ–æ•¸æ“šæ ¼å¼éŒ¯èª¤</p>';
                }
                
            } catch (error) {
                console.error('æª¢æŸ¥æ•¸æ“šå¤±æ•—:', error);
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <h3>âŒ æª¢æŸ¥å¤±æ•—</h3>
                    <p><strong>éŒ¯èª¤ï¼š</strong> ${error.message}</p>
                `;
            }
        }
        
        async function testDoGet() {
            const resultDiv = document.getElementById('doGetResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<p>ğŸ”„ æ­£åœ¨æ¸¬è©¦ doGet å‡½æ•¸...</p>';
            
            try {
                // ç›´æ¥æ¸¬è©¦ doGet å‡½æ•¸
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'GET',
                    mode: 'cors'
                });
                
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <h3>ğŸ”§ doGet å‡½æ•¸æ¸¬è©¦çµæœ</h3>
                    <p><strong>HTTP ç‹€æ…‹ï¼š</strong> ${response.status}</p>
                    <p><strong>å›æ‡‰é¡å‹ï¼š</strong> ${response.headers.get('content-type')}</p>
                    <p><strong>æ•¸æ“šçµæ§‹ï¼š</strong></p>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
                
                if (data.success && data.data) {
                    resultDiv.innerHTML += `
                        <h4>âœ… doGet å‡½æ•¸æ­£å¸¸å·¥ä½œ</h4>
                        <p>è¿”å›äº† ${data.data.length} ç­†æ•¸æ“š</p>
                    `;
                } else {
                    resultDiv.innerHTML += `
                        <h4>âŒ doGet å‡½æ•¸æœ‰å•é¡Œ</h4>
                        <p>éŒ¯èª¤ï¼š${data.error || 'æœªçŸ¥éŒ¯èª¤'}</p>
                    `;
                }
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <h3>âŒ doGet å‡½æ•¸æ¸¬è©¦å¤±æ•—</h3>
                    <p><strong>éŒ¯èª¤ï¼š</strong> ${error.message}</p>
                `;
            }
        }
        
        async function analyzeData() {
            const resultDiv = document.getElementById('analyzeResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<p>ğŸ”„ æ­£åœ¨åˆ†ææ•¸æ“š...</p>';
            
            try {
                const response = await fetch(APPS_SCRIPT_URL, {
                    method: 'GET',
                    mode: 'cors'
                });
                
                const data = await response.json();
                
                if (data.success && data.data) {
                    const records = data.data;
                    const uniqueNames = [...new Set(records.map(r => r.name))];
                    const scoreRange = {
                        min: Math.min(...records.map(r => r.score)),
                        max: Math.max(...records.map(r => r.score))
                    };
                    
                    resultDiv.innerHTML = `
                        <h3>ğŸ“Š æ•¸æ“šåˆ†æçµæœ</h3>
                        <p><strong>ç¸½è¨˜éŒ„æ•¸ï¼š</strong> ${records.length}</p>
                        <p><strong>å”¯ä¸€ç©å®¶æ•¸ï¼š</strong> ${uniqueNames.length}</p>
                        <p><strong>åˆ†æ•¸ç¯„åœï¼š</strong> ${scoreRange.min} - ${scoreRange.max}</p>
                        <p><strong>ç©å®¶åˆ—è¡¨ï¼š</strong></p>
                        <ul>
                            ${uniqueNames.map(name => `<li>${name}</li>`).join('')}
                        </ul>
                    `;
                } else {
                    resultDiv.innerHTML = '<p style="color: red;">âŒ ç„¡æ³•åˆ†ææ•¸æ“š</p>';
                }
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <h3>âŒ åˆ†æå¤±æ•—</h3>
                    <p><strong>éŒ¯èª¤ï¼š</strong> ${error.message}</p>
                `;
            }
        }
    </script>
</body>
</html>
